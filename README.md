# MR-VAE
â€œä¸€ç§åŸºäºMR-VARçš„ä½ç…§åº¦å›¾åƒå¢å¼ºæ–¹æ³•â€[1]  
Low-illumination Image Enhancement Based on MR-VAE
![images](https://github.com/csxuwu/MR-VAE/blob/master/images/MR-VAE.png)

## Abstract
é’ˆå¯¹ä½ç…§åº¦å›¾åƒå¤šé‡å¤±çœŸç‰¹ç‚¹ï¼ˆä½äº®åº¦ã€å¤šå™ªå£°å’Œæ¨¡ç³Šç­‰ï¼‰ï¼Œæœ¬æ–‡åŸºäºå˜åˆ†è‡ªç¼–ç å™¨æå‡ºäº†ä¸€ç§å¤šé‡æ„å˜åˆ†è‡ªç¼–ç å™¨ ï¼ˆMultiple Reconstruction-Variational AutoEncoder,MR-VAEï¼‰ï¼Œé€æ­¥å¢å¼ºã€ä»ç²—åˆ°ç»†åœ°ç”Ÿæˆé«˜è´¨é‡ä½ç…§åº¦å¢å¼ºå›¾åƒã€‚MR-VAE ç”±ç‰¹å¾æ¦‚ç‡åˆ†å¸ƒæ•è·ã€å…¨å±€é‡æ„å’Œç»†èŠ‚é‡æ„ä¸‰ä¸ªæ¨¡å—æ„æˆï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°†å…¨å±€ç‰¹å¾ä¸å±€éƒ¨ç‰¹å¾åˆ†é˜¶æ®µé‡å»ºã€å°†å¤šé‡å¤±çœŸé—®é¢˜é€æ­¥è§£å†³ï¼Œå…¨å±€é‡æ„æ¨¡å—æ„å»ºå›¾åƒå…¨å±€ç‰¹å¾ï¼Œæé«˜å…¨å±€äº®åº¦ï¼Œå¾—åˆ°è¾ƒç²—ç³™çš„å›¾åƒï¼›ç»†èŠ‚é‡æ„æ¨¡å—æƒè¡¡å»å™ªä¸å»æ¨¡ç³Šï¼Œç”Ÿæˆç»†èŠ‚æ›´é€¼çœŸã€å™ªå£°æ›´å°‘ä¸å±€éƒ¨äº®åº¦æ›´åˆé€‚çš„å›¾åƒï¼›æ­¤å¤–ï¼Œæœ¬æ–‡å®šä¹‰äº†ä¸€ä¸ªå¤šé¡¹æŸå¤±å‡½æ•°æ›¿ä»£ğ‘™2æŸå¤±ï¼Œä»¥å¼•å¯¼ç½‘ç»œç”Ÿæˆé«˜è´¨é‡å›¾åƒã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œå¤šé‡æ„ä¸å¤šé¡¹æŸå¤±å‡½æ•°çš„è®¾è®¡æé«˜äº†ç½‘ç»œç”Ÿæˆå¤æ‚å›¾åƒã€å¤„ç†å¤šé‡å¤±çœŸçš„ä½ç…§åº¦å›¾åƒæ€§èƒ½ï¼Œä¸”æé«˜äº†ç”Ÿæˆå›¾åƒçš„è´¨é‡ã€ä¿¡å™ªæ¯”å’Œè§†è§‰ç‰¹æ€§ã€‚  
**å…³é”®è¯** ä½ç…§åº¦å›¾åƒå¢å¼ºï¼›å¤šé‡æ„ï¼›å¤šé¡¹æŸå¤±ï¼›å¤šé‡å¤±çœŸï¼›å˜åˆ†è‡ªç¼–ç ï¼›æ®‹å·®ç½‘ç»œ

According to our investigation, low-illumination images have multiple distortion characteristics (including low light, high noise, blur, etc.). In order to better enhance the low-illumination image, we propose a Multi-Reconstruction Variational AutoEncoder(MR-VAE) based on the Variational AutoEncoder(VAE) to gradually enhance the image and generate high-quality low-illumination enhanced image from coarse to fine. MR-VAE is mainly composed of three modules: Feature Probability Distribution Capture (FPDC), Global Reconstruction(GR),  and Detail Reconstruction(DR). Its key idea is to generate the global and local features of the image in stages, and solve the problem of multiple distortion step by step. Finally, MR-VAE can capture low-illumination to normal illumination, noisy to noiseless, fuzzy to clear composite nonlinear mapping. The FPDC module is mainly used to capture hidden variables that cover the entire image feature, which is equivalent to encoding the entire image. The GR module is mainly used to capture the nonlinear mapping from low-illumination to normal illumination and uses the hidden variables to generate global features of the image step by step (global features include: scene, color distribution, illumination characteristics), and finally obtain appropriate brightness enhancement, rough quality image. The DR module is mainly used to capture composite nonlinear maps from noisy to noiseless and clear to fuzzy, finding a good balance between removing noise and retaining detailed information, helping the network to generate high-quality images which detail more realistic, less noisy, and more suitable for local brightness. More importantly, we redefine a multi-loss function to replace the L2 loss function, which improves the image quality criteria and guides the network to generate high-quality images. This multi-loss function consists of "hidden variable content loss", "global reconstruction loss" and "detail reconstruction loss". Hidden variable content loss helps the FPDC module capture hidden variables that better reflect the probability distribution of the essential content of the image. Global reconstruction loss is used to help the GR module generate large image features and overall brightness. Detail reconstruction loss helps the DR to generate detailed features between rough and high-resolution images and helps DR to be more robust to noise. In addition, based on the MS COCO dataset, we have created pairs of lowlight images for training our network. Gamma correction is used to adjust the brightness, including four different brightness levels. Gaussian noise is used to simulate actual noise, the noise level, and brightness level meet a certain relationship. Gaussian blur is used to simulate the blur of the image to produce a composite image that is very close to the actual low-illumination image. In the experimental stage, We did a complete experiment, including the ablation experiment of the network structure and the comparison experiment with other methods. The ablation experiment is mainly to verify the depth of the network structure and the role of the multi-loss function. The comparison experiment includes the traditional method and the deep learning methods. The experimental results show that the multi-reconstruction and multi-loss function can help the network to generate complex images and improve the network's enhanced performance for low-intensity images with multiple distortions. Indicating that our method can better enhance low-illumination images and has a better ability to remove noise. 

**Keywords**: Low-illumination Image Enhancement; Multiple reconstruction; Multi-loss function;Multiple distortion; Variational AutoEncoder; Residual network

## Codes
### Train
run "main_for_mrvae_v2_1.py"
### Test
run "eval_for_mrvae_v2_1.py" in the eval.

## Citation
[1]æ±Ÿæ³½æ¶›,ä¼æ—­,å¼ å°‘é’¦.ä¸€ç§åŸºäºMR-VAEçš„ä½ç…§åº¦å›¾åƒå¢å¼ºæ–¹æ³•[J].è®¡ç®—æœºå­¦æŠ¥,2020,43(07):1328-1339.


